{% extends "master.html" %}
{% load static %}

{% block title %}Security settings{% endblock %}

{% block content %}
<section class="page-header">
    <div>
        <h1 class="page-title">Security settings</h1>
        <p class="page-description">Strengthen your account with multi-factor authentication and recovery options.</p>
    </div>
</section>

<section class="card-stack">
    <article class="card">
        <div class="page-header">
            <div>
                <h2>Two-factor authentication</h2>
                {% if mfa_enabled %}
                    <p class="field-hint">Your account requires a code from your authenticator app at sign-in.</p>
                {% else %}
                    <p class="field-hint">Add an extra verification step for anyone accessing your vault.</p>
                {% endif %}
            </div>
            <span class="status-badge {% if mfa_enabled %}enabled{% else %}disabled{% endif %}">
                {% if mfa_enabled %}
                <svg class="icon" aria-hidden="true" focusable="false">
                    <use href="{% static 'img/icons/check.svg' %}#icon-check"></use>
                </svg>
                Enabled
                {% else %}
                <svg class="icon" aria-hidden="true" focusable="false">
                    <use href="{% static 'img/icons/eye-off.svg' %}#icon-eye-off"></use>
                </svg>
                Disabled
                {% endif %}
            </span>
        </div>
        <div class="card-stack">
            {% if mfa_enabled %}
                <div class="info-grid">
                    {% for authenticator in totp_authenticators %}
                        <div class="info-row">
                            <span class="info-label">Authenticator</span>
                            <span class="info-value">Added {{ authenticator.created_at|date:"M d, Y" }}</span>
                        </div>
                    {% empty %}
                        <p class="page-description">No authenticators registered yet.</p>
                    {% endfor %}
                    {% if has_recovery_codes %}
                        <div class="info-row">
                            <span class="info-label">Recovery codes</span>
                            <span class="info-value">Configured</span>
                        </div>
                    {% endif %}
                </div>
                <div class="page-actions">
                    <a href="{% url 'regenerate_recovery_codes' %}" class="btn btn-secondary">
                        <svg class="icon" aria-hidden="true" focusable="false">
                            <use href="{% static 'img/icons/copy.svg' %}#icon-copy"></use>
                        </svg>
                        Regenerate recovery codes
                    </a>
                    <form method="post" action="{% url 'disable_2fa' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Disable 2FA</button>
                    </form>
                </div>
            {% else %}
                <div class="card-compact card">
                    <h3>How it works</h3>
                    <ol class="list-muted">
                        <li>Install an authenticator app.</li>
                        <li>Scan our QR code to pair.</li>
                        <li>Enter the 6-digit code to verify.</li>
                        <li>Store recovery codes safely.</li>
                    </ol>
                </div>
                <a href="{% url 'enable_2fa' %}" class="btn btn-primary">Enable two-factor authentication</a>
            {% endif %}
        </div>
    </article>

    <article class="card">
        <h2>Password security</h2>
        <p class="page-description">Use a strong, unique password and update it regularly.</p>
        <div class="page-actions">
            <a href="{% url 'account_change_password' %}" class="btn btn-secondary">Change password</a>
        </div>
    </article>
</section>
{% endblock %}

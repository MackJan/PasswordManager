{% extends "master.html" %}
{% load static %}

{% block title %}Enable two-factor authentication{% endblock %}

{% block content %}
<section class="page-header">
    <div>
        <h1 class="page-title">Enable two-factor authentication</h1>
        <p class="page-description">Secure your vault by requiring a one-time code from an authenticator app each time you sign in.</p>
    </div>
</section>

<section class="card-stack">
    <article class="card card-compact">
        <h2>Step 1</h2>
        <p class="page-description">Install an authenticator app such as Google Authenticator, 1Password, Authy, or Microsoft Authenticator.</p>
    </article>

    <article class="card card-stack">
        <div class="card-compact">
            <h2>Step 2</h2>
            <p class="page-description">Scan the QR code below with your authenticator app.</p>
        </div>
        <div class="card card-compact centered-card">
            <img src="data:image/png;base64,{{ qr_code_data }}" alt="QR code for two-factor setup">
            <div class="card-stack">
                <span class="field-hint">Can't scan the code? Enter the secret manually.</span>
                <code class="code-block" id="totp-secret">{{ secret }}</code>
                <div class="page-actions">
                    <button type="button" class="btn btn-secondary" data-copy="totp-secret">
                        <svg class="icon" aria-hidden="true" focusable="false">
                            <use href="{% static 'img/icons/copy.svg' %}#icon-copy"></use>
                        </svg>
                        Copy secret
                    </button>
                </div>
            </div>
        </div>
    </article>

    <article class="card card-compact">
        <h2>Step 3</h2>
        <p class="page-description">Enter the 6-digit code displayed in your app to confirm setup.</p>
        <form method="post" class="form-grid">
            {% csrf_token %}
            <label for="code">
                Authentication code
                <input type="text" id="code" name="code" pattern="[0-9]{6}" maxlength="6" required autocomplete="off" inputmode="numeric" placeholder="000000">
            </label>
            <div class="page-actions">
                <button type="submit" class="btn btn-primary">Verify and enable</button>
                <a href="{% url 'security_settings' %}" class="btn btn-ghost">Cancel</a>
            </div>
        </form>
    </article>
</section>
{% endblock %}

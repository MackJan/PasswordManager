{% extends "master.html" %}

{% block title %}
Password Manager Item Edit
{% endblock %}

{% block content %}
<head>
    <title>Password Manager - Item Edit</title>
    <script>
        // When the user clicks on <div>, open the popup
        function showPopup(itemid) {
            let popup = document.getElementById("item-" + itemid);
            let backdrop = document.getElementById("popup-backdrop");
            popup.classList.add("show");
            backdrop.classList.add("show");
        }

        // Close the popup
        function closePopup() {
            let popups = document.getElementsByClassName("item-popup");
            let backdrop = document.getElementById("popup-backdrop");
            for (let i = 0; i < popups.length; i++) {
                popups[i].classList.remove("show");
            }
            backdrop.classList.remove("show");
        }

        // Close popup when clicking outside of it
        window.onclick = function (event) {
            let backdrop = document.getElementById("popup-backdrop");
            if (event.target === backdrop) {
                let popups = document.getElementsByClassName("item-popup");
                for (let i = 0; i < popups.length; i++) {
                    popups[i].classList.remove("show");
                }
                backdrop.classList.remove("show");
            }
        }

        // Toggle password visibility
        function togglePassword(element) {
            element.classList.toggle('hidden');
        }
    </script>
</head>
<div class="hero-section">
    <div class="hero-title">
        <h1>Password Manager Vault Edit</h1>
    </div>

    <p class="hero-subtitle">Here you can edit your saved Items</p>

    <div class="vault-items-container">
        {% for item in items %}
        <div class="vault-item">
            <div class="item-info">
                <div class="item-field">
                    <span class="item-label">Name</span>
                    <span class="item-value item-title">{{ item.name }}</span>
                </div>
                <div class="item-field">
                    <span class="item-label">Username</span>
                    <span class="item-value item-username">{{ item.username }}</span>
                </div>
                <div class="item-field">
                    <span class="item-label">Password</span>
                    <span class="item-value item-password hidden" onclick="togglePassword(this)">
                        <span class="password-text">{{ item.password }}</span>
                    </span>
                </div>
                <div class="item-field">
                    <button class="btn btn-primary popup" onclick="showPopup('{{ item.id }}')">Edit</button>
                </div>
            </div>
        </div>
        <div id="item-{{item.id}}" class="item-popup">
            {% include "item-edit.html" with item=item %}
        </div>
        {% endfor %}
    </div>

    <!-- Backdrop overlay -->
    <div id="popup-backdrop" class="popup-backdrop"></div>
</div>
{% endblock %}
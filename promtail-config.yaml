server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  # Django Authentication Logs
  - job_name: django-authentication
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: authentication
          __path__: /var/log/django/authentication.log
    pipeline_stages: &django_structured_pipeline
      - json:
          expressions:
            timestamp: timestamp
            level: level
            logger: logger
            module: module
            message: message
            user_id: user_id
            user_email: user_email
            ip: ip
            path: path
            http_method: http_method
            status_code: status_code
            context_user_pk: context_user_pk
            context_account_id: context_account_id
      - timestamp:
          source: timestamp
          format: RFC3339Nano
      - labels:
          level:
          logger:
          module:
          user_id:
          ip:
          http_method:
          status_code:
      - output:
          source: message

  # Django Vault Logs
  - job_name: django-vault
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: vault
          __path__: /var/log/django/vault.log
    pipeline_stages: *django_structured_pipeline

  # Django Security Logs
  - job_name: django-security
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: security
          __path__: /var/log/django/security.log
    pipeline_stages: *django_structured_pipeline

  # Django Alerts Logs
  - job_name: django-alerts
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: alerts
          __path__: /var/log/django/alerts.log
    pipeline_stages: *django_structured_pipeline

  # Django Application Logs
  - job_name: django-application
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: application
          __path__: /var/log/django/application.log
    pipeline_stages: *django_structured_pipeline

  # Django Framework Logs
  - job_name: django-framework
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: framework
          __path__: /var/log/django/django.log
    pipeline_stages: *django_structured_pipeline

  # Fallback for any other Django logs
  - job_name: django-catchall
    static_configs:
      - targets:
          - localhost
        labels:
          job: django
          log_type: other
          __path__: /var/log/django/*.log
    pipeline_stages: *django_structured_pipeline
